<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TigerClass - Paws to Think</title>
  <style>
    body {
      box-sizing: border-box;
    }

    /* CSS Custom Properties for theming and easy maintenance */
    :root {
      --color-background: #FFF4E6;
      --color-surface: #FFFFFF;
      --color-text: #2C3E50;
      --color-primary: #FF6B6B;
      --color-secondary: #4ECDC4;
      --color-success: #51CF66;
      --color-error: #FF6B6B;
      --color-shadow: rgba(0, 0, 0, 0.1);
      
      --spacing-xs: 0.5rem;
      --spacing-sm: 1rem;
      --spacing-md: 1.5rem;
      --spacing-lg: 2rem;
      --spacing-xl: 3rem;
      
      --border-radius-sm: 0.5rem;
      --border-radius-md: 1rem;
      --border-radius-lg: 1.5rem;
      --border-radius-full: 50%;
      
      --font-size-base: 16px;
      --font-family: 'Comic Sans MS', 'Chalkboard SE', 'Arial Rounded MT Bold', cursive;
      
      --transition-speed: 0.3s;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      width: 100%;
      height: 100%;
      overflow: hidden;
    }

    body {
      font-family: var(--font-family);
      background: var(--color-background);
      color: var(--color-text);
      font-size: var(--font-size-base);
    }

    /* BEM: Container Block */
    .container {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      padding: var(--spacing-md);
      overflow-y: auto;
    }

    /* BEM: Header Block */
    .header {
      text-align: center;
      margin-bottom: var(--spacing-lg);
      position: relative;
    }

    .header__title {
      font-size: calc(var(--font-size-base) * 2.5);
      color: var(--color-primary);
      text-shadow: 2px 2px 4px var(--color-shadow);
      margin-bottom: var(--spacing-sm);
    }

    .header__settings-btn {
      position: absolute;
      top: 0;
      right: 0;
      width: 2.5rem;
      height: 2.5rem;
      background: transparent;
      border: none;
      font-size: calc(var(--font-size-base) * 1.5);
      cursor: pointer;
      opacity: 0.3;
      transition: opacity var(--transition-speed);
    }

    .header__settings-btn:hover {
      opacity: 0.6;
    }

    /* BEM: Stats Block */
    .stats {
      display: flex;
      justify-content: center;
      gap: var(--spacing-lg);
      margin-bottom: var(--spacing-lg);
      flex-wrap: wrap;
    }

    .stats__item {
      background: var(--color-surface);
      padding: var(--spacing-sm) var(--spacing-md);
      border-radius: var(--border-radius-md);
      box-shadow: 0 4px 6px var(--color-shadow);
      min-width: 8rem;
      text-align: center;
    }

    .stats__label {
      font-size: calc(var(--font-size-base) * 0.875);
      color: var(--color-text);
      opacity: 0.7;
      margin-bottom: var(--spacing-xs);
    }

    .stats__value {
      font-size: calc(var(--font-size-base) * 2);
      font-weight: bold;
      color: var(--color-primary);
    }

    .stats__value--correct {
      color: var(--color-success);
    }

    .stats__value--incorrect {
      color: var(--color-error);
    }

    /* BEM: Game Block */
    .game {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: var(--spacing-xl);
    }

    .game__question {
      background: var(--color-surface);
      padding: var(--spacing-xl);
      border-radius: var(--border-radius-lg);
      box-shadow: 0 8px 16px var(--color-shadow);
      text-align: center;
      min-width: 15rem;
    }

    .game__question-text {
      font-size: calc(var(--font-size-base) * 1.5);
      margin-bottom: var(--spacing-md);
      color: var(--color-text);
    }

    .game__play-button {
      width: 8rem;
      height: 8rem;
      border-radius: 50%;
      background: var(--color-primary);
      border: none;
      cursor: pointer;
      transition: all var(--transition-speed);
      box-shadow: 0 6px 12px var(--color-shadow);
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto;
      position: relative;
    }

    .game__play-button::before {
      content: '';
      width: 0;
      height: 0;
      border-style: solid;
      border-width: 1.5rem 0 1.5rem 2.5rem;
      border-color: transparent transparent transparent white;
      margin-left: 0.5rem;
    }

    .game__play-button:hover {
      transform: scale(1.1);
      box-shadow: 0 8px 16px var(--color-shadow);
    }

    .game__play-button:active {
      transform: scale(1.05);
    }

    .game__play-button--playing {
      animation: pulse 0.5s ease-in-out infinite;
    }

    .game__choices {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(8rem, 1fr));
      gap: var(--spacing-md);
      width: 100%;
      max-width: 40rem;
    }

    .game__choice {
      background: var(--color-secondary);
      color: white;
      border: none;
      padding: var(--spacing-lg);
      font-size: calc(var(--font-size-base) * 2);
      font-weight: bold;
      border-radius: var(--border-radius-md);
      cursor: pointer;
      transition: all var(--transition-speed);
      box-shadow: 0 4px 8px var(--color-shadow);
      font-family: var(--font-family);
      touch-action: manipulation;
    }

    .game__choice:hover {
      transform: translateY(-4px);
      box-shadow: 0 6px 12px var(--color-shadow);
    }

    .game__choice:active {
      transform: translateY(-2px);
    }

    .game__choice--correct {
      background: var(--color-success);
      animation: pulse 0.5s ease-in-out;
    }

    .game__choice--incorrect {
      background: var(--color-error);
      animation: shake 0.5s ease-in-out;
    }

    .game__complete {
      text-align: center;
      background: var(--color-surface);
      padding: var(--spacing-xl);
      border-radius: var(--border-radius-lg);
      box-shadow: 0 8px 16px var(--color-shadow);
      max-width: 30rem;
    }

    .game__complete-emoji {
      font-size: calc(var(--font-size-base) * 6);
      margin-bottom: var(--spacing-md);
      animation: confetti-bounce 1s ease-in-out infinite;
    }

    @keyframes confetti-bounce {
      0%, 100% { 
        transform: scale(1);
      }
      50% { 
        transform: scale(1.2);
      }
    }

    .game__complete-title {
      font-size: calc(var(--font-size-base) * 2.5);
      font-weight: bold;
      color: var(--color-primary);
      margin-bottom: var(--spacing-md);
    }

    .game__complete-message {
      font-size: calc(var(--font-size-base) * 1.25);
      color: var(--color-text);
      margin-bottom: var(--spacing-lg);
    }

    .game__complete-button {
      background: var(--color-primary);
      color: white;
      border: none;
      padding: var(--spacing-md) var(--spacing-xl);
      font-size: calc(var(--font-size-base) * 1.25);
      font-weight: bold;
      border-radius: var(--border-radius-md);
      cursor: pointer;
      transition: all var(--transition-speed);
      font-family: var(--font-family);
      box-shadow: 0 4px 8px var(--color-shadow);
    }

    .game__complete-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px var(--color-shadow);
    }

    /* BEM: Feedback Block */
    .feedback {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 1000;
      pointer-events: none;
      opacity: 0;
      transition: opacity var(--transition-speed);
    }

    .feedback--show {
      opacity: 1;
    }

    .feedback__content {
      background: white;
      padding: var(--spacing-xl);
      border-radius: var(--border-radius-lg);
      box-shadow: 0 12px 24px rgba(0, 0, 0, 0.2);
      text-align: center;
      min-width: 20rem;
      transform: scale(0);
      transition: transform var(--transition-speed);
    }

    .feedback--show .feedback__content {
      transform: scale(1);
    }

    .feedback__emoji {
      font-size: calc(var(--font-size-base) * 5);
      margin-bottom: var(--spacing-md);
    }

    .feedback__message {
      font-size: calc(var(--font-size-base) * 2);
      font-weight: bold;
      color: var(--color-text);
    }

    /* BEM: Results Modal Block */
    .results-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1500;
      overflow-y: auto;
    }

    .results-modal--show {
      display: flex;
      align-items: flex-start;
      justify-content: center;
      padding: var(--spacing-lg);
    }

    .results-modal__content {
      background: white;
      padding: var(--spacing-xl);
      border-radius: var(--border-radius-lg);
      max-width: 40rem;
      width: 100%;
      margin: var(--spacing-lg) auto;
      box-shadow: 0 12px 24px rgba(0, 0, 0, 0.3);
    }

    .results-modal__header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--spacing-lg);
      padding-bottom: var(--spacing-md);
      border-bottom: 2px solid var(--color-background);
    }

    .results-modal__title {
      font-size: calc(var(--font-size-base) * 2);
      color: var(--color-primary);
    }

    .results-modal__close {
      background: transparent;
      border: none;
      font-size: calc(var(--font-size-base) * 2);
      cursor: pointer;
      color: var(--color-text);
      opacity: 0.6;
      transition: opacity var(--transition-speed);
    }

    .results-modal__close:hover {
      opacity: 1;
    }

    .results-modal__grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(4rem, 1fr));
      gap: var(--spacing-sm);
      max-height: 25rem;
      overflow-y: auto;
      padding: var(--spacing-sm);
    }

    .results-modal__number {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: var(--spacing-sm);
      border-radius: var(--border-radius-sm);
      background: var(--color-background);
      min-height: 4rem;
    }

    .results-modal__number-value {
      font-size: calc(var(--font-size-base) * 1.5);
      font-weight: bold;
      color: var(--color-text);
      margin-bottom: var(--spacing-xs);
    }

    .results-modal__number-icon {
      font-size: calc(var(--font-size-base) * 1.25);
    }

    .results-modal__number--correct {
      background: #E7F5E8;
      border: 2px solid var(--color-success);
    }

    .results-modal__number--incorrect {
      background: #FFE7E7;
      border: 2px solid var(--color-error);
    }

    .results-modal__number--mixed {
      background: #FFF4E6;
      border: 2px solid #FFA94D;
    }

    .results-modal__legend {
      display: flex;
      gap: var(--spacing-md);
      justify-content: center;
      margin-top: var(--spacing-lg);
      padding-top: var(--spacing-md);
      border-top: 2px solid var(--color-background);
      flex-wrap: wrap;
    }

    .results-modal__legend-item {
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
      font-size: calc(var(--font-size-base) * 0.875);
    }

    /* BEM: Backend Modal Block */
    .backend-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 2000;
      overflow-y: auto;
    }

    .backend-modal--show {
      display: flex;
      align-items: flex-start;
      justify-content: center;
      padding: var(--spacing-lg);
    }

    .backend-modal__content {
      background: white;
      padding: var(--spacing-xl);
      border-radius: var(--border-radius-lg);
      max-width: 40rem;
      width: 100%;
      margin: var(--spacing-lg) auto;
      box-shadow: 0 12px 24px rgba(0, 0, 0, 0.3);
    }

    .backend-modal__header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--spacing-lg);
      padding-bottom: var(--spacing-md);
      border-bottom: 2px solid var(--color-background);
    }

    .backend-modal__title {
      font-size: calc(var(--font-size-base) * 2);
      color: var(--color-primary);
    }

    .backend-modal__close {
      background: transparent;
      border: none;
      font-size: calc(var(--font-size-base) * 2);
      cursor: pointer;
      color: var(--color-text);
      opacity: 0.6;
      transition: opacity var(--transition-speed);
    }

    .backend-modal__close:hover {
      opacity: 1;
    }

    .backend-modal__section {
      margin-bottom: var(--spacing-lg);
    }

    .backend-modal__label {
      display: block;
      font-size: calc(var(--font-size-base) * 1.125);
      font-weight: bold;
      margin-bottom: var(--spacing-sm);
      color: var(--color-text);
    }

    .backend-modal__input {
      width: 100%;
      padding: var(--spacing-sm);
      font-size: var(--font-size-base);
      border: 2px solid var(--color-background);
      border-radius: var(--border-radius-sm);
      font-family: var(--font-family);
    }

    .backend-modal__input:focus {
      outline: none;
      border-color: var(--color-secondary);
    }

    .backend-modal__choices-buttons {
      display: flex;
      gap: var(--spacing-sm);
    }

    .backend-modal__choice-button {
      flex: 1;
      padding: var(--spacing-md);
      font-size: calc(var(--font-size-base) * 1.25);
      font-weight: bold;
      border: 2px solid var(--color-secondary);
      background: white;
      color: var(--color-text);
      border-radius: var(--border-radius-sm);
      cursor: pointer;
      transition: all var(--transition-speed);
      font-family: var(--font-family);
    }

    .backend-modal__choice-button:hover {
      background: var(--color-background);
    }

    .backend-modal__choice-button--active {
      background: var(--color-secondary);
      color: white;
      border-color: var(--color-secondary);
    }

    .backend-modal__checkbox-group {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(3rem, 1fr));
      gap: var(--spacing-sm);
      max-height: 15rem;
      overflow-y: auto;
      padding: var(--spacing-sm);
      background: var(--color-background);
      border-radius: var(--border-radius-sm);
    }

    .backend-modal__checkbox-label {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: var(--spacing-sm);
      background: white;
      border-radius: var(--border-radius-sm);
      cursor: pointer;
      transition: all var(--transition-speed);
      border: 2px solid transparent;
    }

    .backend-modal__checkbox-label:hover {
      border-color: var(--color-secondary);
    }

    .backend-modal__checkbox {
      display: none;
    }

    .backend-modal__checkbox:checked + .backend-modal__checkbox-label {
      background: var(--color-secondary);
      color: white;
      font-weight: bold;
    }

    .backend-modal__button {
      background: var(--color-primary);
      color: white;
      border: none;
      padding: var(--spacing-md) var(--spacing-lg);
      font-size: calc(var(--font-size-base) * 1.125);
      font-weight: bold;
      border-radius: var(--border-radius-md);
      cursor: pointer;
      width: 100%;
      margin-top: var(--spacing-md);
      transition: all var(--transition-speed);
      font-family: var(--font-family);
      box-shadow: 0 4px 8px var(--color-shadow);
    }

    .backend-modal__button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px var(--color-shadow);
    }

    .backend-modal__button:active {
      transform: translateY(0);
    }

    /* Tab Navigation Styles */
    .backend-modal__tabs {
      display: flex;
      gap: var(--spacing-xs);
      margin-bottom: var(--spacing-lg);
      border-bottom: 2px solid var(--color-background);
    }

    .backend-modal__tab {
      flex: 1;
      padding: var(--spacing-md);
      background: transparent;
      border: none;
      border-bottom: 3px solid transparent;
      font-size: calc(var(--font-size-base) * 1);
      font-weight: bold;
      color: var(--color-text);
      opacity: 0.6;
      cursor: pointer;
      transition: all var(--transition-speed);
      font-family: var(--font-family);
    }

    .backend-modal__tab:hover {
      opacity: 0.8;
      background: var(--color-background);
    }

    .backend-modal__tab--active {
      opacity: 1;
      border-bottom-color: var(--color-primary);
      color: var(--color-primary);
    }

    .backend-modal__tab-content {
      display: none;
    }

    .backend-modal__tab-content--active {
      display: block;
    }

    .backend-modal__select-all {
      display: flex;
      gap: var(--spacing-sm);
      margin-bottom: var(--spacing-sm);
    }

    .backend-modal__select-button {
      background: var(--color-secondary);
      color: white;
      border: none;
      padding: var(--spacing-xs) var(--spacing-md);
      font-size: calc(var(--font-size-base) * 0.875);
      border-radius: var(--border-radius-sm);
      cursor: pointer;
      transition: opacity var(--transition-speed);
      font-family: var(--font-family);
    }

    .backend-modal__select-button:hover {
      opacity: 0.8;
    }

    .backend-modal__select-button--deselect {
      background: var(--color-primary);
    }

    /* Toggle Switch Styles */
    .backend-modal__toggle-container {
      display: flex;
      align-items: center;
      gap: var(--spacing-md);
      padding: var(--spacing-md);
      background: var(--color-background);
      border-radius: var(--border-radius-sm);
    }

    .backend-modal__toggle-label {
      flex: 1;
      font-size: calc(var(--font-size-base) * 1);
      color: var(--color-text);
      font-weight: normal;
    }

    .backend-modal__toggle-switch {
      position: relative;
      width: 3.5rem;
      height: 2rem;
      background: #ccc;
      border-radius: 2rem;
      cursor: pointer;
      transition: background var(--transition-speed);
    }

    .backend-modal__toggle-switch--active {
      background: var(--color-secondary);
    }

    .backend-modal__toggle-slider {
      position: absolute;
      top: 0.25rem;
      left: 0.25rem;
      width: 1.5rem;
      height: 1.5rem;
      background: white;
      border-radius: 50%;
      transition: transform var(--transition-speed);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .backend-modal__toggle-switch--active .backend-modal__toggle-slider {
      transform: translateX(1.5rem);
    }

    .backend-modal__toggle-input {
      display: none;
    }

    /* Animations */
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-10px); }
      75% { transform: translateX(10px); }
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
      .header__title {
        font-size: calc(var(--font-size-base) * 2);
      }

      .game__number {
        font-size: calc(var(--font-size-base) * 4);
      }

      .game__choice {
        font-size: calc(var(--font-size-base) * 1.5);
      }

      .game__choices {
        grid-template-columns: repeat(auto-fit, minmax(6rem, 1fr));
      }
    }

    @media (max-width: 480px) {
      .container {
        padding: var(--spacing-sm);
      }

      .stats {
        gap: var(--spacing-sm);
      }

      .stats__item {
        min-width: 6rem;
      }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body><!-- Main game container -->
  <div class="container"><!-- Header with title and discreet settings button -->
   <header class="header">
    <h1 class="header__title" id="gameTitle">Paws to Think</h1><button class="header__settings-btn" id="settingsBtn" aria-label="Settings">üêæ</button>
   </header><!-- Statistics display -->
   <div class="stats">
    <div class="stats__item">
     <div class="stats__label">
      Progress
     </div>
     <div class="stats__value" id="progressCount">
      0/10
     </div>
    </div>
    <div class="stats__item">
     <div class="stats__label">
      Correct
     </div>
     <div class="stats__value stats__value--correct" id="correctCount">
      0
     </div>
    </div>
    <div class="stats__item">
     <div class="stats__label">
      Incorrect
     </div>
     <div class="stats__value stats__value--incorrect" id="incorrectCount">
      0
     </div>
    </div>
   </div><!-- Game area -->
   <main class="game">
    <div class="game__question"><button class="game__play-button" id="playButton" aria-label="Play number"></button>
    </div>
    <div class="game__choices" id="choicesContainer"><!-- Choices will be dynamically generated -->
    </div><!-- Game complete screen -->
    <div class="game__complete" id="gameComplete" style="display: none;">
     <div class="game__complete-emoji" id="confettiEmoji" style="cursor: pointer;">
      üéä
     </div>
     <div class="game__complete-title">
      Great Job!
     </div>
     <div class="game__complete-message">
      You've completed all the numbers!
     </div><button class="game__complete-button" id="viewResultsBtn">View Results</button>
    </div>
   </main>
  </div><!-- Feedback overlay -->
  <div class="feedback" id="feedback">
   <div class="feedback__content">
    <div class="feedback__emoji" id="feedbackEmoji">
     üéâ
    </div>
    <div class="feedback__message" id="feedbackMessage">
     Great job!
    </div>
   </div>
  </div><!-- Results modal -->
  <div class="results-modal" id="resultsModal">
   <div class="results-modal__content">
    <div class="results-modal__header">
     <h2 class="results-modal__title">Results Summary</h2><button class="results-modal__close" id="closeResultsModal" aria-label="Close">√ó</button>
    </div>
    <div class="results-modal__grid" id="resultsGrid"><!-- Results will be dynamically generated -->
    </div>
    <div class="results-modal__legend">
     <div class="results-modal__legend-item"><span style="width: 1rem; height: 1rem; background: #51CF66; border-radius: 0.25rem; display: inline-block;"></span> <span>All Correct</span>
     </div>
     <div class="results-modal__legend-item"><span style="width: 1rem; height: 1rem; background: #FFA94D; border-radius: 0.25rem; display: inline-block;"></span> <span>Some Incorrect</span>
     </div>
     <div class="results-modal__legend-item"><span style="width: 1rem; height: 1rem; background: #FF6B6B; border-radius: 0.25rem; display: inline-block;"></span> <span>All Incorrect</span>
     </div>
    </div>
   </div>
  </div><!-- Backend modal for teacher settings -->
  <div class="backend-modal" id="backendModal">
   <div class="backend-modal__content">
    <div class="backend-modal__header">
     <h2 class="backend-modal__title">Teacher Settings</h2><button class="backend-modal__close" id="closeModal" aria-label="Close">√ó</button>
    </div><!-- Tab Navigation -->
    <div class="backend-modal__tabs"><button class="backend-modal__tab backend-modal__tab--active" data-tab="personalize">Personalize</button> <button class="backend-modal__tab" data-tab="lesson">Lesson</button> <button class="backend-modal__tab" data-tab="options">Options</button>
    </div><!-- Personalize Tab -->
    <div class="backend-modal__tab-content backend-modal__tab-content--active" id="personalizeTab">
     <div class="backend-modal__section"><label class="backend-modal__label" for="studentNameInput">Student Name</label> <input type="text" id="studentNameInput" class="backend-modal__input" placeholder="Enter student name">
     </div>
    </div><!-- Options Tab -->
    <div class="backend-modal__tab-content" id="optionsTab"><!-- Number range selection -->
     <div class="backend-modal__section"><label class="backend-modal__label">Number of Choices</label>
      <div class="backend-modal__choices-buttons" id="choicesButtons"><button class="backend-modal__choice-button" data-choices="2">2</button> <button class="backend-modal__choice-button" data-choices="3">3</button> <button class="backend-modal__choice-button" data-choices="4">4</button>
      </div>
     </div><!-- Allow retry toggle -->
     <div class="backend-modal__section">
      <div class="backend-modal__toggle-container"><label class="backend-modal__toggle-label" for="allowRetryToggle"> Allow students to try again on incorrect answers </label> <input type="checkbox" id="allowRetryToggle" class="backend-modal__toggle-input">
       <div class="backend-modal__toggle-switch" id="retryToggleSwitch">
        <div class="backend-modal__toggle-slider"></div>
       </div>
      </div>
     </div>
    </div><!-- Lesson Tab -->
    <div class="backend-modal__tab-content" id="lessonTab">
     <div class="backend-modal__section"><label class="backend-modal__label" for="lessonModeSelect">Lesson Type</label> <select id="lessonModeSelect" class="backend-modal__input" style="cursor: pointer;"> <option value="numbers">Numbers</option> <option value="letters">Letters</option> </select>
     </div>
     <div class="backend-modal__section"><label class="backend-modal__label" id="lessonItemsLabel">Select Numbers to Teach:</label>
      <div class="backend-modal__select-all"><button class="backend-modal__select-button" id="selectAllBtn">Select All</button> <button class="backend-modal__select-button backend-modal__select-button--deselect" id="deselectAllBtn">Deselect All</button>
      </div>
      <div class="backend-modal__checkbox-group" id="numbersCheckboxes"><!-- Checkboxes will be dynamically generated -->
      </div>
     </div>
    </div><!-- Action buttons (always visible) -->
    <div style="display: flex; gap: var(--spacing-sm); margin-top: var(--spacing-md);"><button class="backend-modal__button" id="cancelBtn" style="flex: 1;">Cancel</button> <button class="backend-modal__button" id="saveBtn" style="background: var(--color-secondary); flex: 1;">Save</button>
    </div>
   </div>
  </div>
  <script>
    // Configuration object managed by Element SDK
    const defaultConfig = {
      game_title: "Paws to Think",
      correct_feedback: "Great job!",
      incorrect_feedback: "Try again!",
      primary_color: "#FF6B6B",
      secondary_color: "#4ECDC4",
      background_color: "#FFF4E6",
      text_color: "#2C3E50",
      surface_color: "#FFFFFF",
      font_family: "Comic Sans MS",
      font_size: 16
    };

    // Game state - manages all game-related data
    const gameState = {
      correctAnswers: 0,
      incorrectAnswers: 0,
      currentNumber: null,
      choices: [],
      selectedNumbers: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9], // Default numbers to teach
      selectedLetters: ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J'], // Default letters to teach
      askedNumbers: [], // Track which numbers have been asked in current session
      choicesCount: 2, // Default number of choices per question
      allowRetry: false, // Allow students to try again on incorrect answers
      settingsClickCount: 0, // Track clicks for triple-click unlock
      settingsClickTimeout: null, // Timeout for resetting click count
      results: {}, // Track correct/incorrect for each number
      studentName: '', // Student name
      lessonMode: 'numbers' // 'numbers' or 'letters'
    };

    // Load game state from localStorage
    function loadGameState() {
      const savedState = localStorage.getItem('numberGameState');
      if (savedState) {
        const parsed = JSON.parse(savedState);
        gameState.correctAnswers = parsed.correctAnswers || 0;
        gameState.incorrectAnswers = parsed.incorrectAnswers || 0;
        gameState.selectedNumbers = parsed.selectedNumbers || gameState.selectedNumbers;
        gameState.selectedLetters = parsed.selectedLetters || gameState.selectedLetters;
        gameState.askedNumbers = parsed.askedNumbers || [];
        gameState.choicesCount = parsed.choicesCount || gameState.choicesCount;
        gameState.passcode = parsed.passcode || gameState.passcode;
        gameState.allowRetry = parsed.allowRetry !== undefined ? parsed.allowRetry : true;
        gameState.results = parsed.results || {};
        gameState.studentName = parsed.studentName || '';
        gameState.lessonMode = parsed.lessonMode || 'numbers';
      }
      updateStats();
    }

    // Save game state to localStorage
    function saveGameState() {
      const stateToSave = {
        correctAnswers: gameState.correctAnswers,
        incorrectAnswers: gameState.incorrectAnswers,
        selectedNumbers: gameState.selectedNumbers,
        selectedLetters: gameState.selectedLetters,
        askedNumbers: gameState.askedNumbers,
        choicesCount: gameState.choicesCount,
        allowRetry: gameState.allowRetry,
        results: gameState.results,
        studentName: gameState.studentName,
        lessonMode: gameState.lessonMode
      };
      localStorage.setItem('numberGameState', JSON.stringify(stateToSave));
    }

    // Update statistics display
    function updateStats() {
      document.getElementById('correctCount').textContent = gameState.correctAnswers;
      document.getElementById('incorrectCount').textContent = gameState.incorrectAnswers;
      const totalItems = gameState.lessonMode === 'numbers' ? gameState.selectedNumbers.length : gameState.selectedLetters.length;
      document.getElementById('progressCount').textContent = 
        `${gameState.askedNumbers.length}/${totalItems}`;
    }

    // Generate a random item (number or letter) from the selected items that hasn't been asked yet
    function getRandomNumber() {
      const selectedItems = gameState.lessonMode === 'numbers' ? gameState.selectedNumbers : gameState.selectedLetters;
      
      // Get items that haven't been asked yet
      const unaskedItems = selectedItems.filter(
        item => !gameState.askedNumbers.includes(item)
      );
      
      // If all items have been asked, return null to end the game
      if (unaskedItems.length === 0) {
        return null;
      }
      
      return unaskedItems[Math.floor(Math.random() * unaskedItems.length)];
    }

    // Generate array of unique random choices including the correct answer
    // All choices must come from the selected items being taught
    function generateChoices(correctAnswer, count) {
      const choices = [correctAnswer];
      const selectedItems = gameState.lessonMode === 'numbers' ? gameState.selectedNumbers : gameState.selectedLetters;
      
      // Create a copy of selected items without the correct answer
      const availableItems = selectedItems.filter(item => item !== correctAnswer);
      
      // If we don't have enough items selected, limit count to what we have
      const maxChoices = Math.min(count, selectedItems.length);
      
      // Add random choices from selected items until we reach the desired count
      while (choices.length < maxChoices && availableItems.length > 0) {
        const randomIndex = Math.floor(Math.random() * availableItems.length);
        choices.push(availableItems[randomIndex]);
        availableItems.splice(randomIndex, 1);
      }
      
      // Shuffle the choices array
      return choices.sort(() => Math.random() - 0.5);
    }

    // Speak the number using Web Speech API
    function speakNumber(number) {
      // Cancel any ongoing speech
      window.speechSynthesis.cancel();
      
      // For letters, convert to lowercase to prevent "capital" announcement
      let textToSpeak = number.toString();
      if (gameState.lessonMode === 'letters') {
        textToSpeak = textToSpeak.toLowerCase();
      }
      
      const utterance = new SpeechSynthesisUtterance(textToSpeak);
      utterance.rate = 0.8; // Slightly slower for clarity
      utterance.pitch = 1.2; // Slightly higher pitch for children
      utterance.volume = 1;
      utterance.lang = 'en-US';
      
      const playButton = document.getElementById('playButton');
      
      utterance.onstart = () => {
        playButton.classList.add('game__play-button--playing');
      };
      
      utterance.onend = () => {
        playButton.classList.remove('game__play-button--playing');
      };
      
      utterance.onerror = () => {
        playButton.classList.remove('game__play-button--playing');
      };
      
      window.speechSynthesis.speak(utterance);
    }

    // Generate a new question
    function generateQuestion() {
      const selectedItems = gameState.lessonMode === 'numbers' ? gameState.selectedNumbers : gameState.selectedLetters;
      if (selectedItems.length === 0) {
        // If no items are selected, show a message
        const itemType = gameState.lessonMode === 'numbers' ? 'numbers' : 'letters';
        document.getElementById('choicesContainer').innerHTML = 
          `<p style="text-align: center; color: var(--color-text);">Please select ${itemType} in teacher settings!</p>`;
        return;
      }

      gameState.currentNumber = getRandomNumber();
      
      // Check if all numbers have been completed
      if (gameState.currentNumber === null) {
        showGameComplete();
        return;
      }
      
      gameState.choices = generateChoices(gameState.currentNumber, gameState.choicesCount);
      
      // Update UI
      document.getElementById('gameComplete').style.display = 'none';
      document.querySelector('.game__question').style.display = 'block';
      renderChoices();
      
      // Automatically play the number when a new question is generated
      setTimeout(() => speakNumber(gameState.currentNumber), 300);
    }

    // Show game completion screen
    function showGameComplete() {
      const completeTitle = document.querySelector('.game__complete-title');
      const completeMessage = document.querySelector('.game__complete-message');
      
      // Calculate percentage correct
      const totalAttempts = gameState.correctAnswers + gameState.incorrectAnswers;
      const percentageCorrect = totalAttempts > 0 
        ? Math.round((gameState.correctAnswers / totalAttempts) * 100) 
        : 0;
      
      // Determine encouragement message based on percentage
      let encouragement = 'Nice try!';
      if (percentageCorrect > 75) {
        encouragement = 'Awesome!';
      } else if (percentageCorrect >= 51) {
        encouragement = 'Good job!';
      }
      
      completeTitle.textContent = encouragement;
      
      if (gameState.studentName) {
        completeMessage.textContent = `${gameState.studentName}, you got ${percentageCorrect}% correct!`;
      } else {
        completeMessage.textContent = `You got ${percentageCorrect}% correct!`;
      }
      
      document.getElementById('gameComplete').style.display = 'block';
      document.getElementById('choicesContainer').innerHTML = '';
      document.querySelector('.game__question').style.display = 'none';
    }

    // Restart the game with the same settings
    function restartGame() {
      gameState.askedNumbers = [];
      gameState.correctAnswers = 0;
      gameState.incorrectAnswers = 0;
      gameState.results = {};
      updateStats();
      saveGameState();
      generateQuestion();
    }

    // Show results modal
    function showResults() {
      const modal = document.getElementById('resultsModal');
      const grid = document.getElementById('resultsGrid');
      grid.innerHTML = '';

      // Get all selected items and display them
      const selectedItems = gameState.lessonMode === 'numbers' ? gameState.selectedNumbers : gameState.selectedLetters;
      selectedItems.forEach(num => {
        const result = gameState.results[num];
        const numberDiv = document.createElement('div');
        numberDiv.className = 'results-modal__number';

        const numberValue = document.createElement('div');
        numberValue.className = 'results-modal__number-value';
        numberValue.textContent = num;

        const icon = document.createElement('div');
        icon.className = 'results-modal__number-icon';

        if (!result || (result.correct === 0 && result.incorrect === 0)) {
          // Number wasn't attempted
          icon.textContent = '‚Äî';
          numberDiv.style.opacity = '0.5';
        } else if (result.correct > 0 && result.incorrect === 0) {
          // All correct
          icon.textContent = '‚úì';
          numberDiv.classList.add('results-modal__number--correct');
        } else if (result.correct === 0 && result.incorrect > 0) {
          // All incorrect
          icon.textContent = '‚úó';
          numberDiv.classList.add('results-modal__number--incorrect');
        } else {
          // Mixed results
          icon.textContent = `${result.correct}/${result.correct + result.incorrect}`;
          numberDiv.classList.add('results-modal__number--mixed');
        }

        numberDiv.appendChild(numberValue);
        numberDiv.appendChild(icon);
        grid.appendChild(numberDiv);
      });

      modal.classList.add('results-modal--show');
    }

    // Close results modal
    function closeResults() {
      document.getElementById('resultsModal').classList.remove('results-modal--show');
    }

    // Render choice buttons
    function renderChoices() {
      const container = document.getElementById('choicesContainer');
      container.innerHTML = '';
      
      gameState.choices.forEach(number => {
        const button = document.createElement('button');
        button.className = 'game__choice';
        button.textContent = number;
        button.addEventListener('click', () => handleChoice(number, button));
        container.appendChild(button);
      });
    }

    // Handle user's choice
    function handleChoice(chosenNumber, button) {
      const isCorrect = chosenNumber === gameState.currentNumber;
      
      // Disable all buttons temporarily
      const allButtons = document.querySelectorAll('.game__choice');
      allButtons.forEach(btn => btn.disabled = true);
      
      if (isCorrect) {
        button.classList.add('game__choice--correct');
        gameState.correctAnswers++;
        
        // Track result for this number
        if (!gameState.results[gameState.currentNumber]) {
          gameState.results[gameState.currentNumber] = { correct: 0, incorrect: 0 };
        }
        gameState.results[gameState.currentNumber].correct++;
        
        // Mark this number as asked (only on correct answer)
        if (!gameState.askedNumbers.includes(gameState.currentNumber)) {
          gameState.askedNumbers.push(gameState.currentNumber);
        }
        
        showFeedback(true);
        
        // Generate new question after delay
        setTimeout(() => {
          generateQuestion();
        }, 1500);
      } else {
        button.classList.add('game__choice--incorrect');
        gameState.incorrectAnswers++;
        
        // Track result for this number
        if (!gameState.results[gameState.currentNumber]) {
          gameState.results[gameState.currentNumber] = { correct: 0, incorrect: 0 };
        }
        gameState.results[gameState.currentNumber].incorrect++;
        
        showFeedback(false);
        
        // Check if retry is allowed
        if (gameState.allowRetry) {
          // Re-enable buttons after animation
          setTimeout(() => {
            button.classList.remove('game__choice--incorrect');
            allButtons.forEach(btn => btn.disabled = false);
          }, 600);
        } else {
          // Move to next question after delay (no retry)
          // Mark as asked even if incorrect
          if (!gameState.askedNumbers.includes(gameState.currentNumber)) {
            gameState.askedNumbers.push(gameState.currentNumber);
          }
          
          setTimeout(() => {
            generateQuestion();
          }, 1500);
        }
      }
      
      updateStats();
      saveGameState();
    }

    // Show feedback overlay
    function showFeedback(isCorrect) {
      const feedback = document.getElementById('feedback');
      const emoji = document.getElementById('feedbackEmoji');
      const message = document.getElementById('feedbackMessage');
      
      // Get personalized name or use generic message
      const nameSuffix = gameState.studentName ? `, ${gameState.studentName}` : '';
      
      if (isCorrect) {
        emoji.textContent = 'üéâ';
        const correctMessages = [
          'Great job',
          'Excellent',
          'Well done',
          'Perfect',
          'Amazing'
        ];
        const randomMessage = correctMessages[Math.floor(Math.random() * correctMessages.length)];
        message.textContent = randomMessage + nameSuffix + '!';
        
        window.speechSynthesis.cancel();
        // Remove comma from speech to avoid delay
        const speechText = gameState.studentName ? randomMessage + ' ' + gameState.studentName + '!' : randomMessage + '!';
        const utterance = new SpeechSynthesisUtterance(speechText);
        utterance.rate = 0.9;
        utterance.pitch = 1.2;
        window.speechSynthesis.speak(utterance);
        
        feedback.classList.add('feedback--show');
        
        setTimeout(() => {
          feedback.classList.remove('feedback--show');
        }, 1000);
      } else {
        // Show different feedback based on whether retry is allowed
        if (gameState.allowRetry) {
          emoji.textContent = 'üí™';
          message.textContent = 'Try again' + nameSuffix + '!';
          window.speechSynthesis.cancel();
          // Remove comma from speech to avoid delay
          const speechText = gameState.studentName ? 'Try again ' + gameState.studentName + '!' : 'Try again!';
          const utterance = new SpeechSynthesisUtterance(speechText);
          utterance.rate = 0.9;
          utterance.pitch = 1.2;
          
          // After "Try again" speech, replay the question
          utterance.onend = () => {
            setTimeout(() => {
              if (gameState.currentNumber !== null) {
                speakNumber(gameState.currentNumber);
              }
            }, 500);
          };
          
          window.speechSynthesis.speak(utterance);
          
          feedback.classList.add('feedback--show');
          
          setTimeout(() => {
            feedback.classList.remove('feedback--show');
          }, 1000);
        }
        // If retry is off, no feedback popup is shown for incorrect answers
      }
    }

    // Backend modal functionality
    const backendModal = document.getElementById('backendModal');
    const settingsBtn = document.getElementById('settingsBtn');
    const closeModal = document.getElementById('closeModal');

    // Tab switching functionality
    document.querySelectorAll('.backend-modal__tab').forEach(tab => {
      tab.addEventListener('click', () => {
        const tabName = tab.dataset.tab;
        
        // Remove active class from all tabs and contents
        document.querySelectorAll('.backend-modal__tab').forEach(t => t.classList.remove('backend-modal__tab--active'));
        document.querySelectorAll('.backend-modal__tab-content').forEach(c => c.classList.remove('backend-modal__tab-content--active'));
        
        // Add active class to clicked tab and corresponding content
        tab.classList.add('backend-modal__tab--active');
        document.getElementById(tabName + 'Tab').classList.add('backend-modal__tab-content--active');
      });
    });

    // Triple-click to open modal
    settingsBtn.addEventListener('click', () => {
      // Increment click count
      gameState.settingsClickCount++;
      
      // Clear any existing timeout
      if (gameState.settingsClickTimeout) {
        clearTimeout(gameState.settingsClickTimeout);
      }
      
      // If clicked 3 times, open modal
      if (gameState.settingsClickCount >= 3) {
        // Reset temp variables to current saved state
        tempLessonMode = gameState.lessonMode;
        tempChoicesCount = gameState.choicesCount;
        
        // Always show Personalize tab first
        document.querySelectorAll('.backend-modal__tab').forEach(t => t.classList.remove('backend-modal__tab--active'));
        document.querySelectorAll('.backend-modal__tab-content').forEach(c => c.classList.remove('backend-modal__tab-content--active'));
        document.querySelector('.backend-modal__tab[data-tab="personalize"]').classList.add('backend-modal__tab--active');
        document.getElementById('personalizeTab').classList.add('backend-modal__tab-content--active');
        
        backendModal.classList.add('backend-modal--show');
        loadSettingsToUI();
        gameState.settingsClickCount = 0;
        return;
      }
      
      // Reset click count after 1 second of inactivity
      gameState.settingsClickTimeout = setTimeout(() => {
        gameState.settingsClickCount = 0;
      }, 1000);
    });

    // Close modal
    closeModal.addEventListener('click', () => {
      backendModal.classList.remove('backend-modal--show');
    });

    // Close modal when clicking outside
    backendModal.addEventListener('click', (e) => {
      if (e.target === backendModal) {
        backendModal.classList.remove('backend-modal--show');
      }
    });

    // Generate checkboxes based on lesson mode
    function generateLessonCheckboxes() {
      const checkboxContainer = document.getElementById('numbersCheckboxes');
      const itemsLabel = document.getElementById('lessonItemsLabel');
      checkboxContainer.innerHTML = '';
      
      if (gameState.lessonMode === 'numbers') {
        itemsLabel.textContent = 'Select Numbers to Teach:';
        // Generate number checkboxes (0-99)
        for (let i = 0; i < 100; i++) {
          const checkbox = document.createElement('input');
          checkbox.type = 'checkbox';
          checkbox.id = `item_${i}`;
          checkbox.className = 'backend-modal__checkbox';
          checkbox.value = i;
          checkbox.checked = gameState.selectedNumbers.includes(i);
          
          const label = document.createElement('label');
          label.htmlFor = `item_${i}`;
          label.className = 'backend-modal__checkbox-label';
          label.textContent = i;
          
          checkboxContainer.appendChild(checkbox);
          checkboxContainer.appendChild(label);
        }
      } else {
        itemsLabel.textContent = 'Select Letters to Teach:';
        // Generate letter checkboxes (A-Z)
        const alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('');
        alphabet.forEach(letter => {
          const checkbox = document.createElement('input');
          checkbox.type = 'checkbox';
          checkbox.id = `item_${letter}`;
          checkbox.className = 'backend-modal__checkbox';
          checkbox.value = letter;
          checkbox.checked = gameState.selectedLetters.includes(letter);
          
          const label = document.createElement('label');
          label.htmlFor = `item_${letter}`;
          label.className = 'backend-modal__checkbox-label';
          label.textContent = letter;
          
          checkboxContainer.appendChild(checkbox);
          checkboxContainer.appendChild(label);
        });
      }
    }
    
    // Load current settings into UI
    function loadSettingsToUI() {
      // Set student name
      document.getElementById('studentNameInput').value = gameState.studentName || '';
      
      // Set lesson mode from saved state
      const lessonModeSelect = document.getElementById('lessonModeSelect');
      lessonModeSelect.value = gameState.lessonMode;
      
      // Set choices count buttons
      const choiceButtons = document.querySelectorAll('.backend-modal__choice-button');
      choiceButtons.forEach(btn => {
        btn.classList.remove('backend-modal__choice-button--active');
        if (parseInt(btn.dataset.choices) === gameState.choicesCount) {
          btn.classList.add('backend-modal__choice-button--active');
        }
      });
      
      // Set allow retry toggle
      const retryToggle = document.getElementById('allowRetryToggle');
      const retryToggleSwitch = document.getElementById('retryToggleSwitch');
      retryToggle.checked = gameState.allowRetry;
      if (gameState.allowRetry) {
        retryToggleSwitch.classList.add('backend-modal__toggle-switch--active');
      } else {
        retryToggleSwitch.classList.remove('backend-modal__toggle-switch--active');
      }
      
      // Generate checkboxes based on saved lesson mode
      generateLessonCheckboxes();
    }

    // Handle lesson mode dropdown change (temporary, not saved until Save is clicked)
    let tempLessonMode = gameState.lessonMode;
    
    document.getElementById('lessonModeSelect').addEventListener('change', (e) => {
      tempLessonMode = e.target.value;
      
      // Update UI temporarily to show correct checkboxes
      const checkboxContainer = document.getElementById('numbersCheckboxes');
      const itemsLabel = document.getElementById('lessonItemsLabel');
      checkboxContainer.innerHTML = '';
      
      if (tempLessonMode === 'numbers') {
        itemsLabel.textContent = 'Select Numbers to Teach:';
        // Generate number checkboxes (0-99)
        for (let i = 0; i < 100; i++) {
          const checkbox = document.createElement('input');
          checkbox.type = 'checkbox';
          checkbox.id = `item_${i}`;
          checkbox.className = 'backend-modal__checkbox';
          checkbox.value = i;
          checkbox.checked = gameState.selectedNumbers.includes(i);
          
          const label = document.createElement('label');
          label.htmlFor = `item_${i}`;
          label.className = 'backend-modal__checkbox-label';
          label.textContent = i;
          
          checkboxContainer.appendChild(checkbox);
          checkboxContainer.appendChild(label);
        }
      } else {
        itemsLabel.textContent = 'Select Letters to Teach:';
        // Generate letter checkboxes (A-Z)
        const alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('');
        alphabet.forEach(letter => {
          const checkbox = document.createElement('input');
          checkbox.type = 'checkbox';
          checkbox.id = `item_${letter}`;
          checkbox.className = 'backend-modal__checkbox';
          checkbox.value = letter;
          checkbox.checked = gameState.selectedLetters.includes(letter);
          
          const label = document.createElement('label');
          label.htmlFor = `item_${letter}`;
          label.className = 'backend-modal__checkbox-label';
          label.textContent = letter;
          
          checkboxContainer.appendChild(checkbox);
          checkboxContainer.appendChild(label);
        });
      }
    });

    // Handle choice button clicks (temporary, not saved until Save is clicked)
    let tempChoicesCount = gameState.choicesCount;
    
    document.getElementById('choicesButtons').addEventListener('click', (e) => {
      if (e.target.classList.contains('backend-modal__choice-button')) {
        const choiceButtons = document.querySelectorAll('.backend-modal__choice-button');
        choiceButtons.forEach(btn => btn.classList.remove('backend-modal__choice-button--active'));
        e.target.classList.add('backend-modal__choice-button--active');
        tempChoicesCount = parseInt(e.target.dataset.choices);
      }
    });

    // Handle retry toggle switch clicks
    document.getElementById('retryToggleSwitch').addEventListener('click', () => {
      const toggle = document.getElementById('allowRetryToggle');
      const toggleSwitch = document.getElementById('retryToggleSwitch');
      toggle.checked = !toggle.checked;
      toggleSwitch.classList.toggle('backend-modal__toggle-switch--active');
    });

    // Select all numbers
    document.getElementById('selectAllBtn').addEventListener('click', () => {
      const checkboxes = document.querySelectorAll('#numbersCheckboxes input[type="checkbox"]');
      checkboxes.forEach(cb => cb.checked = true);
    });

    // Deselect all numbers
    document.getElementById('deselectAllBtn').addEventListener('click', () => {
      const checkboxes = document.querySelectorAll('#numbersCheckboxes input[type="checkbox"]');
      checkboxes.forEach(cb => cb.checked = false);
    });

    // Cancel button - close modal without saving and reset UI
    document.getElementById('cancelBtn').addEventListener('click', () => {
      // Reset temp variables to saved state
      tempLessonMode = gameState.lessonMode;
      tempChoicesCount = gameState.choicesCount;
      backendModal.classList.remove('backend-modal--show');
    });

    // Save settings
    document.getElementById('saveBtn').addEventListener('click', () => {
      // Get student name
      gameState.studentName = document.getElementById('studentNameInput').value.trim();
      
      // Get lesson mode from temp variable
      gameState.lessonMode = tempLessonMode;
      
      // Get selected items based on mode
      const checkboxes = document.querySelectorAll('#numbersCheckboxes input[type="checkbox"]:checked');
      if (gameState.lessonMode === 'numbers') {
        gameState.selectedNumbers = Array.from(checkboxes).map(cb => parseInt(cb.value));
      } else {
        gameState.selectedLetters = Array.from(checkboxes).map(cb => cb.value);
      }
      
      // Get choices count from temp variable
      gameState.choicesCount = tempChoicesCount;
      
      // Get allow retry setting
      gameState.allowRetry = document.getElementById('allowRetryToggle').checked;
      
      saveGameState();
      backendModal.classList.remove('backend-modal--show');
      
      // Restart game with new settings
      restartGame();
    });

    // Element SDK implementation
    async function onConfigChange(config) {
      const customFont = config.font_family || defaultConfig.font_family;
      const baseFontStack = 'Arial, sans-serif';
      const baseSize = config.font_size || defaultConfig.font_size;

      // Update CSS custom properties
      document.documentElement.style.setProperty('--color-primary', config.primary_color || defaultConfig.primary_color);
      document.documentElement.style.setProperty('--color-secondary', config.secondary_color || defaultConfig.secondary_color);
      document.documentElement.style.setProperty('--color-background', config.background_color || defaultConfig.background_color);
      document.documentElement.style.setProperty('--color-text', config.text_color || defaultConfig.text_color);
      document.documentElement.style.setProperty('--color-surface', config.surface_color || defaultConfig.surface_color);
      document.documentElement.style.setProperty('--font-family', `${customFont}, ${baseFontStack}`);
      document.documentElement.style.setProperty('--font-size-base', `${baseSize}px`);

      // Update text content
      document.getElementById('gameTitle').textContent = config.game_title || defaultConfig.game_title;
    }

    // Initialize Element SDK
    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig: defaultConfig,
        onConfigChange: onConfigChange,
        mapToCapabilities: (config) => ({
          recolorables: [
            {
              get: () => config.background_color || defaultConfig.background_color,
              set: (value) => {
                config.background_color = value;
                window.elementSdk.setConfig({ background_color: value });
              }
            },
            {
              get: () => config.surface_color || defaultConfig.surface_color,
              set: (value) => {
                config.surface_color = value;
                window.elementSdk.setConfig({ surface_color: value });
              }
            },
            {
              get: () => config.text_color || defaultConfig.text_color,
              set: (value) => {
                config.text_color = value;
                window.elementSdk.setConfig({ text_color: value });
              }
            },
            {
              get: () => config.primary_color || defaultConfig.primary_color,
              set: (value) => {
                config.primary_color = value;
                window.elementSdk.setConfig({ primary_color: value });
              }
            },
            {
              get: () => config.secondary_color || defaultConfig.secondary_color,
              set: (value) => {
                config.secondary_color = value;
                window.elementSdk.setConfig({ secondary_color: value });
              }
            }
          ],
          borderables: [],
          fontEditable: {
            get: () => config.font_family || defaultConfig.font_family,
            set: (value) => {
              config.font_family = value;
              window.elementSdk.setConfig({ font_family: value });
            }
          },
          fontSizeable: {
            get: () => config.font_size || defaultConfig.font_size,
            set: (value) => {
              config.font_size = value;
              window.elementSdk.setConfig({ font_size: value });
            }
          }
        }),
        mapToEditPanelValues: (config) => new Map([
          ["game_title", config.game_title || defaultConfig.game_title],
          ["correct_feedback", config.correct_feedback || defaultConfig.correct_feedback],
          ["incorrect_feedback", config.incorrect_feedback || defaultConfig.incorrect_feedback]
        ])
      });
    }

    // View results button
    document.getElementById('viewResultsBtn').addEventListener('click', () => {
      showResults();
    });

    // Close results modal
    document.getElementById('closeResultsModal').addEventListener('click', () => {
      closeResults();
    });

    // Close results modal when clicking outside
    document.getElementById('resultsModal').addEventListener('click', (e) => {
      if (e.target.id === 'resultsModal') {
        closeResults();
      }
    });

    // Play button - speak the number again
    document.getElementById('playButton').addEventListener('click', () => {
      if (gameState.currentNumber !== null) {
        speakNumber(gameState.currentNumber);
      }
    });

    // Triple-click confetti emoji to restart game
    let confettiClickCount = 0;
    let confettiClickTimeout = null;
    
    document.getElementById('confettiEmoji').addEventListener('click', () => {
      confettiClickCount++;
      
      if (confettiClickTimeout) {
        clearTimeout(confettiClickTimeout);
      }
      
      if (confettiClickCount >= 3) {
        confettiClickCount = 0;
        restartGame();
        return;
      }
      
      confettiClickTimeout = setTimeout(() => {
        confettiClickCount = 0;
      }, 1000);
    });

    // Initialize game on load
    loadGameState();
    generateQuestion();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a2c166691c838e4',t:'MTc2Mzg1Mjg5My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
